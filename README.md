# Yet Another Disk Open API

### Вступительное задание в Осеннюю Школу Бэкенд Разработки Яндекса 2022. Разработать бэкенд для веб-сервиса хранения файлов, аналогичный сервису Яндекс Диск.

### Реализованные endpoints

* **POST** `/imports` импорт элементов файловой системы 
* **DELETE** `/delete/{id}?date=` удаление элемента по идентификатору с параметром времени
* **GET** `/nodes/{id}` получение информации об элементе по идентификатору

* **GET** `/updates?date=` получение списка файлов, которые были обновлены за последние 24 часа включительно [date - 24h, date] от времени переданном в запросе
* **GET** `/node/{id}/history?dateStart=&dateEnd=` получение истории обновлений по элементу за заданный полуинтервал [from, to).


## Технические требования

### `/imports`
Элементы импортированные повторно обновляют текущие. Изменение типа элемента с папки на файл и с файла на папку не допускается. Порядок элементов в запросе является произвольным.

* id каждого элемента является уникальным среди остальных элементов
* поле id не может быть равно null
* родителем элемента может быть только папка
* принадлежность к папке определяется полем parentId
* элементы могут не иметь родителя (при обновлении parentId на null элемент остается без родителя)
* поле url при импорте папки всегда должно быть равно null
* размер поля url при импорте файла всегда должен быть меньше либо равным 255
* поле size при импорте папки всегда должно быть равно null
* поле size для файлов всегда должно быть больше 0
* при обновлении элемента обновленными считаются все их параметры
* при обновлении параметров элемента обязательно обновляется поле date в соответствии с временем обновления
* в одном запросе не может быть двух элементов с одинаковым id
* дата обрабатывается согласно ISO 8601 (такой придерживается OpenAPI). Если дата не удовлетворяет данному формату, ответом будет код 400.
Гарантируется, что во входных данных нет циклических зависимостей и поле updateDate монотонно возрастает. Гарантируется, что при проверке передаваемое время кратно секундам.


### `/delete/{id}?date=`

* при удалении папки удаляются все дочерние элементы
* доступ к истории обновлений удаленного элемента невозможен

### `/nodes/{id}`

* при получении информации о папке также предоставляется информация о её дочерних элементах
* для пустой папки поле children равно пустому массиву, а для файла равно null
* размер папки - это суммарный размер всех её элементов
* если папка не содержит элементов, то размер равен 0
* при обновлении размера элемента, суммарный размер папки, которая содержит этот элемент, тоже обновляется

### `/updates?date=`

* получение списка файлов, которые были обновлены за последние 24 часа включительно [date - 24h, date] от времени переданном в запросе

### `/node/{id}/history?dateStart=&dateEnd=`

* получение истории обновлений по элементу за заданный полуинтервал [from, to)
* история по удаленным элементам недоступна
* размер папки - это суммарный размер всех её элементов
* если в запросе не передан параметр date, выводится статистика за все время

## Технологии
* Python
* Django REST Framework 
* PostgreSQL
* Docker  

## Запуск через Docker

1. Скопировать репозиторий

    `git clone https://github.com/rusnikolaev1/YandexDiskAPI.git`
2. Перейдите в директорию

    `cd YandexDiskAPI`
3. Создайте файл `.env` командой `touch .env` и перейдите в режим редактирования `touch .env`
4. В `.env` файле нужно указать следующее

    ```
    DB_ENGINE=django.db.backends.postgresql
    DB_NAME=disk_db
    POSTGRES_USER=postgres 
    POSTGRES_PASSWORD=postgres_password
    DB_HOST= db
    DB_PORT=5432
    SECRET_KEY=foo 
    DJANGO_DEBUG=0 
    DJANGO_ALLOWED_HOSTS=localhost 127.0.0.1 [::1] 10.21.2.43 0.0.0.0 127.0.0.1 web
    ```
5. Соберите Docker контейнер 
    `sudo docker-compose -f docker-compose.yaml up -d --build`
6. Примените миграции

    `sudo docker-compose -f docker-compose.yaml exec web python manage.py makemigrations`
    `sudo docker-compose -f docker-compose.yaml exec web python manage.py migrate`
8. Создайте суперпользователя

    `sudo docker-compose exec web python manage.py createsuperuser`

